- job:
    name: gophercloud-unittest
    parent: golang-test
    description: |
      Run gophercloud unit test
    run: .zuul/playbooks/gophercloud-unittest/run.yaml
    nodeset: ubuntu-xenial-ut

- job:
    name: gophercloud-acceptance-test-base
    parent: golang-test
    run: .zuul/playbooks/gophercloud-acceptance-test/run.yaml
    description: |
      Base job for all gophercloud acceptance tests
    timeout: 18000 # 5 hours
    abstract: true
    nodeset: ubuntu-focal
    irrelevant-files:
      - ^.*\.md$
      - ^LICENSE$

- job:
    name: gophercloud-acceptance-test-compute
    parent: gophercloud-acceptance-test-base
    description: |
      Run gophercloud compute acceptance test on master branch. This runs when any file is patched
      except if it's doc.
    vars:
      # the list of all available tests can generated by:
      # find acceptance/openstack -name '*_test.go' -exec dirname {} \; | sort -n | uniq -c | awk '{print $2}'
      acceptance_tests:
        - acceptance/openstack
        - acceptance/openstack/compute/v2
        - acceptance/openstack/container/v1
        - acceptance/openstack/identity/v2
        - acceptance/openstack/identity/v3
        - acceptance/openstack/keymanager/v1
        - acceptance/openstack/orchestration/v1
        - acceptance/openstack/placement/v1
      devstack_services:
        - barbican
        - heat
        - zun

- job:
    name: gophercloud-acceptance-test-compute-ussuri
    parent: gophercloud-acceptance-test-compute
    nodeset: ubuntu-bionic
    description: |
      Run gophercloud compute acceptance test on ussuri branch
    vars:
      global_env:
        OS_BRANCH: stable/ussuri

- job:
    name: gophercloud-acceptance-test-compute-train
    parent: gophercloud-acceptance-test-compute
    nodeset: ubuntu-xenial
    description: |
      Run gophercloud compute acceptance test on train branch
    vars:
      global_env:
        OS_BRANCH: stable/train

- job:
    name: gophercloud-acceptance-test-compute-stein
    parent: gophercloud-acceptance-test-compute
    nodeset: ubuntu-xenial
    description: |
      Run gophercloud compute acceptance test on stein branch
    vars:
      global_env:
        OS_BRANCH: stable/stein

- job:
    name: gophercloud-acceptance-test-compute-rocky
    parent: gophercloud-acceptance-test-compute
    nodeset: ubuntu-xenial
    description: |
      Run gophercloud compute acceptance test on rocky branch
    vars:
      global_env:
        OS_BRANCH: stable/rocky

- job:
    name: gophercloud-acceptance-test-compute-queens
    parent: gophercloud-acceptance-test-compute
    description: |
      Run gophercloud compute acceptance test on queens branch
    nodeset: ubuntu-xenial
    vars:
      global_env:
        OS_BRANCH: stable/queens

# NOTE: A Pike-based devstack environment is currently
# not building correctly. This might be a temporary issue.
- job:
    name: gophercloud-acceptance-test-compute-pike
    parent: gophercloud-acceptance-test-compute
    description: |
      Run gophercloud compute acceptance test on pike branch
    nodeset: ubuntu-xenial
    vars:
      global_env:
        OS_BRANCH: stable/pike

- job:
    name: gophercloud-acceptance-test-compute-ocata
    parent: gophercloud-acceptance-test-compute
    description: |
      Run gophercloud compute acceptance test on ocata branch
    nodeset: ubuntu-xenial
    vars:
      global_env:
        OS_BRANCH: stable/ocata

# NOTE: A Newton-based devstack environment is currently
# not building correctly. This might be a temporary issue.
- job:
    name: gophercloud-acceptance-test-compute-newton
    parent: gophercloud-acceptance-test-compute
    description: |
      Run gophercloud compute acceptance test on newton branch
    nodeset: ubuntu-xenial
    vars:
      global_env:
        OS_BRANCH: stable/newton

# The following jobs are maintained because they are parents
# for gophercloud v0.4.0 acceptance tests in theopenlab/openlab-zuul-jobs.
# It'll be removed once we finished the migration to Github actions.
- job:
    name: gophercloud-acceptance-test-legacy
    parent: gophercloud-acceptance-test-base
    description: |
      THIS JOB REMAINS FOR LEGACY. Will be removed soon to be replaced by its variants.
      Run gophercloud acceptance test on the master branch. This runs when any file is patched
      except if it's doc.
    vars:
      acceptance_tests:
        - acceptance/openstack
        - acceptance/openstack/container/v1
        - acceptance/openstack/orchestration/v1
        - acceptance/openstack/placement/v1
      devstack_services:
        - manila
        - zun

- job:
    name: gophercloud-acceptance-test-stein
    parent: gophercloud-acceptance-test-legacy
    nodeset: ubuntu-xenial
    description: |
      Run gophercloud acceptance test on stein branch
    vars:
      global_env:
        OS_BRANCH: stable/stein

- job:
    name: gophercloud-acceptance-test-rocky
    parent: gophercloud-acceptance-test-legacy
    nodeset: ubuntu-xenial
    description: |
      Run gophercloud acceptance test on rocky branch
    vars:
      global_env:
        OS_BRANCH: stable/rocky

- job:
    name: gophercloud-acceptance-test-queens
    parent: gophercloud-acceptance-test-legacy
    description: |
      Run gophercloud acceptance test on queens branch
    nodeset: ubuntu-xenial
    vars:
      global_env:
        OS_BRANCH: stable/queens

# NOTE: A Pike-based devstack environment is currently
# not building correctly. This might be a temporary issue.
- job:
    name: gophercloud-acceptance-test-pike
    parent: gophercloud-acceptance-test-legacy
    description: |
      Run gophercloud acceptance test on pike branch
    nodeset: ubuntu-xenial
    vars:
      global_env:
        OS_BRANCH: stable/pike

- job:
    name: gophercloud-acceptance-test-ocata
    parent: gophercloud-acceptance-test-legacy
    description: |
      Run gophercloud acceptance test on ocata branch
    nodeset: ubuntu-xenial
    vars:
      global_env:
        OS_BRANCH: stable/ocata

# NOTE: A Newton-based devstack environment is currently
# not building correctly. This might be a temporary issue.
- job:
    name: gophercloud-acceptance-test-newton
    parent: gophercloud-acceptance-test-legacy
    description: |
      Run gophercloud acceptance test on newton branch
    nodeset: ubuntu-xenial
    vars:
      global_env:
        OS_BRANCH: stable/newton

- project:
    name: gophercloud/gophercloud
    check:
      jobs:
        - gophercloud-unittest
        - gophercloud-acceptance-test-compute
    recheck-newton:
      jobs:
        - gophercloud-acceptance-test-compute-newton
    recheck-ocata:
      jobs:
        - gophercloud-acceptance-test-compute-ocata
    recheck-pike:
      jobs:
        - gophercloud-acceptance-test-compute-pike
    recheck-queens:
      jobs:
        - gophercloud-acceptance-test-compute-queens
    recheck-rocky:
      jobs:
        - gophercloud-acceptance-test-compute-rocky
    recheck-stein:
      jobs:
        - gophercloud-acceptance-test-compute-stein
    recheck-train:
      jobs:
        - gophercloud-acceptance-test-compute-train
    recheck-ussuri:
      jobs:
        - gophercloud-acceptance-test-compute-ussuri
